<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>2020 0CTF Unlimited | Tyaoo's Blog</title><meta name="keywords" content="CTF"><meta name="author" content="Tyaoo"><meta name="copyright" content="Tyaoo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="PHP AST + 反混淆 + 矩阵快速幂  唯一带有Web特征的逆向题">
<meta property="og:type" content="article">
<meta property="og:title" content="2020 0CTF Unlimited">
<meta property="og:url" content="https://tyaoo.github.io/2020/09/29/2020-0CTF-Unlimited/index.html">
<meta property="og:site_name" content="Tyaoo&#39;s Blog">
<meta property="og:description" content="PHP AST + 反混淆 + 矩阵快速幂  唯一带有Web特征的逆向题">
<meta property="og:locale">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2020-09-29T07:10:02.000Z">
<meta property="article:modified_time" content="2020-10-03T16:05:14.367Z">
<meta property="article:author" content="Tyaoo">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tyaoo.github.io/2020/09/29/2020-0CTF-Unlimited/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2020 0CTF Unlimited',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-10-04 00:05:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Tyaoo's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">35</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Tyaoo's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2020 0CTF Unlimited</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-09-29T07:10:02.000Z" title="Created 2020-09-29 15:10:02">2020-09-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-03T16:05:14.367Z" title="Updated 2020-10-04 00:05:14">2020-10-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2020 0CTF Unlimited"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>PHP AST + 反混淆 + 矩阵快速幂</p>
</blockquote>
<p>唯一带有Web特征的逆向题</p>
<span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://mega.nz/file/uJ4HgQTK#xq0vn5txVQ7kgroD5x4b3kpd87-fKviU8_Cuwvb7pAc">题目</a>是一个经过混淆的PHP抽象语法树文件，请点击题目下载</p>
<p>一开始想直接找抽象语法树（AST）转为PHP代码的函数，找到了<a target="_blank" rel="noopener" href="https://github.com/nikic/PHP-Parser/blob/master/doc/component/Pretty_printing.markdown">pretty_printing</a>，但是尝试许久，无法直接将AST初始化</p>
<h3 id="JsonDecoder"><a href="#JsonDecoder" class="headerlink" title="JsonDecoder"></a>JsonDecoder</h3><p>继续查资料看到PHP-Parser可以将json字符串和AST进行互转</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nikic/PHP-Parser/blob/master/lib/PhpParser/JsonDecoder.php">https://github.com/nikic/PHP-Parser/blob/master/lib/PhpParser/JsonDecoder.php</a></p>
<p>AST转json脚本如下</p>
<pre><code class="php">&lt;?php
require dirname(__FILE__).&#39;/vendor/autoload.php&#39;;
use PhpParser\Error;
use PhpParser\ParserFactory;
use PhpParser\PrettyPrinter;
use PhpParser\NodeDumper;

$code = &lt;&lt;&lt;&#39;CODE&#39;
&lt;?php

function printLine($msg) &#123;
    echo $msg;
&#125;
CODE;

// PHP转化为AST再转化为Json
$parser = (new ParserFactory)-&gt;create(ParserFactory::PREFER_PHP7);
try &#123;
    // PHP =&gt; AST
    $ast = $parser-&gt;parse($code);
    $dumper = new NodeDumper;
    echo $dumper-&gt;dump($ast) . &quot;\n&quot;;

    // AST =&gt; Json
    $json = json_encode($ast, JSON_PRETTY_PRINT);
    echo $json, &quot;\n&quot;;

&#125; catch (PhpParser\Error $e) &#123;
    echo &#39;Parse Error: &#39;, $e-&gt;getMessage();
&#125;

// Json转化为AST再转化为PHP
$json = file_get_contents(&quot;3.json&quot;);
// $json = &lt;&lt;&lt;&#39;CODE&#39;
// ]
// CODE;
// Json =&gt; AST
$jsonDecoder = new PhpParser\JsonDecoder();
$ast = $jsonDecoder-&gt;decode($json);
// AST =&gt; PHP
$parser = (new ParserFactory)-&gt;create(ParserFactory::PREFER_PHP7);
$prettyPrinter = new PrettyPrinter\Standard;
$code = $prettyPrinter-&gt;prettyPrint($ast);
echo $code, &quot;\n&quot;;</code></pre>
<p>其中json字符串如下</p>
<pre><code class="json">[
    &#123;
        &quot;nodeType&quot;: &quot;Stmt_Function&quot;,
        &quot;byRef&quot;: false,
        &quot;name&quot;: &#123;
            &quot;nodeType&quot;: &quot;Identifier&quot;,
            &quot;name&quot;: &quot;printLine&quot;
        &#125;,
        &quot;params&quot;: [
            &#123;
                &quot;nodeType&quot;: &quot;Param&quot;,
                &quot;type&quot;: null,
                &quot;byRef&quot;: false,
                &quot;variadic&quot;: false,
                &quot;var&quot;: &#123;
                    &quot;nodeType&quot;: &quot;Expr_Variable&quot;,
                    &quot;name&quot;: &quot;msg&quot;,
                    &quot;attributes&quot;: &#123;
                        &quot;startLine&quot;: 3,
                        &quot;endLine&quot;: 3
                    &#125;
                &#125;,
                &quot;default&quot;: null,
                &quot;flags&quot;: 0,
                &quot;attrGroups&quot;: []
            &#125;
        ],
        &quot;returnType&quot;: null,
        &quot;stmts&quot;: [
            &#123;
                &quot;nodeType&quot;: &quot;Stmt_Echo&quot;,
                &quot;exprs&quot;: [
                    &#123;
                        &quot;nodeType&quot;: &quot;Expr_Variable&quot;,
                        &quot;name&quot;: &quot;msg&quot;
                    &#125;
                ]
            &#125;
        ],
        &quot;attrGroups&quot;: []
    &#125;
]</code></pre>
<p>AST如下</p>
<pre><code class="json">array(
    0: Stmt_Function(
        attrGroups: array(
        )
        byRef: false
        name: Identifier(
            name: printLine
        )
        params: array(
            0: Param(
                attrGroups: array(
                )
                flags: 0
                type: null
                byRef: false
                variadic: false
                var: Expr_Variable(
                    name: msg
                )
                default: null
            )
        )
        returnType: null
        stmts: array(
            0: Stmt_Echo(
                exprs: array(
                    0: Expr_Variable(
                        name: msg
                    )
                )
            )
        )
    )
)</code></pre>
<p>根据上面的例子，我们可以观察到要把AST转为Json需要进行以下处理：</p>
<ol>
<li>将<code>array(...)</code>转换为<code>[...]</code></li>
<li>将<code>Stmt_Function(...)</code> 转化为<code>&#123;&quot;nodeType&quot;: &quot;Stmt_Function&quot;, ...&#125;</code></li>
<li>对于全部字符串要加上引号</li>
<li>在<code>&quot;nodeType&quot;</code>后面添加<code>&quot;attributes&quot;: &#123;&#125;</code>属性 </li>
</ol>
<p>这里给出一个AST转Json的脚本</p>
<pre><code class="python">import re

data = open(&quot;output.txt&quot;, &quot;r&quot;).readlines()
out = open(&quot;4.json&quot;, &quot;w&quot;)
lines = len(data)

brackets = []

for line in range(lines):
    tmp = data[line].strip(&quot;\n&quot;)
    # 检测 array
    res1 = re.findall(r&quot;array\(&quot;, tmp)
    if res1:
        brackets.append(&quot;]&quot;)
        tmp = tmp.replace(&quot;array(&quot;, &quot;[&quot;)
    # 检测 class
    res2 = re.findall(r&quot;(\w+)\(&quot;, tmp)
    if res2:
        brackets.append(&quot;&#125;&quot;)
        tmp = tmp.replace(res2[0] + &quot;(&quot;, &quot;&#123;nodeType: %s, attributes: &#123;&#125;&quot; % res2[0])
    # 删除多余标签
    res3 = re.findall(r&quot;(\d+: )&quot;, tmp)
    if res3:
        tmp = tmp.replace(res3[0], &#39;&#39;)
    # 添加引号
    res4 = re.findall(r&quot;(flag\&#123;| \&#125;|[\w\-]+)&quot;, tmp)
    if res4:
        for word in res4:
            if not (word.isdigit() or word == &quot;null&quot; or word == &quot;true&quot; or word == &quot;false&quot;):
                if word == &quot; &#125;&quot;:
                    word = &quot;&#125;&quot;
                tmp = tmp.replace(word, &#39;&quot;%s&quot;&#39; % word)
    # 匹配右括号
    if &quot;)&quot; in tmp:
        tmp = tmp.replace(&quot;)&quot;, brackets.pop())

    # 添加逗号
    if ((line + 1) &lt; lines) and (not &quot;)&quot; in data[line + 1]) and (not &quot;[&quot; in tmp):
        tmp = tmp + &quot;,&quot; 
    # 写进文件
    out.write(tmp + &quot;\n&quot;)
out.close()</code></pre>
<p>最后再用上面的pretty_printing代码转出一份稍微好看点的混淆过的PHP代码</p>
<pre><code class="php">&lt;?php 
$l1IIl1II1l = function ($lII1lI1IlI) &#123;
    return function ($II1IlllI11) use($lII1lI1IlI) &#123;
        return function ($ll1IlllIIl) use($II1IlllI11, $lII1lI1IlI) &#123;
            return $II1IlllI11($lII1lI1IlI($II1IlllI11)($ll1IlllIIl));
        &#125;;
    &#125;;
&#125;;
$llIIllIlll = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI + 1;
&#125;;
$I1lll111II = function ($lIlIll1111) &#123;
    return function ($II1IIl1Ill) use($lIlIll1111) &#123;
        return function ($II1IlllI11) use($lIlIll1111, $II1IIl1Ill) &#123;
            return function ($ll1IlllIIl) use($II1IlllI11, $lIlIll1111, $II1IIl1Ill) &#123;
                return $lIlIll1111($II1IlllI11)($II1IIl1Ill($II1IlllI11)($ll1IlllIIl));
            &#125;;
        &#125;;
    &#125;;
&#125;;
$I1II11lIl1 = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI - 1;
&#125;;
$I1IIlII1Il = function ($II1IlllI11) &#123;
    return function ($ll1IlllIIl) &#123;
        return $ll1IlllIIl;
    &#125;;
&#125;;
$IIl1II1lIl = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI * 3 % 7;
&#125;;
$I1IllI1l11 = function ($lIlIll1111) use($I1lll111II, $I1IIlII1Il) &#123;
    return function ($II1IIl1Ill) use($lIlIll1111, $I1lll111II, $I1IIlII1Il) &#123;
        return $lIlIll1111($I1lll111II($II1IIl1Ill))($I1IIlII1Il);
    &#125;;
&#125;;
$l1I11lll1l = function ($II1IlllI11) &#123;
    return function ($ll1IlllIIl) use($II1IlllI11) &#123;
        return $II1IlllI11($ll1IlllIIl);
    &#125;;
&#125;;
$lIl1l1lIlI = function ($lII1lI1IlI) &#123;
    return ($lII1lI1IlI + 1) % 1000000007;
&#125;;
$l1llIlll1l = array(array($I1lll111II($l1IIl1II1l($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))))($l1I11lll1l)))($l1I11lll1l), $I1lll111II($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1IIl1II1l($l1I11lll1l))))($I1lll111II($l1I11lll1l)($I1lll111II($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))), $l1IIl1II1l($I1lll111II($I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($l1I11lll1l))))($l1I11lll1l))($l1I11lll1l)), $I1IllI1l11($l1IIl1II1l($l1I11lll1l))($l1IIl1II1l($l1I11lll1l)), $I1IIlII1Il, $I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1IIl1II1l($l1I11lll1l)))), $I1lll111II($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1IllI1l11($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l))))), $l1IIl1II1l($l1IIl1II1l($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))), $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))), array($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($l1I11lll1l))), $I1IIlII1Il, $l1IIl1II1l($l1IIl1II1l($l1I11lll1l)), $I1lll111II($I1lll111II($I1IllI1l11($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))($l1I11lll1l))($l1I11lll1l), $I1IIlII1Il, $l1IIl1II1l($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1IIl1II1l($l1I11lll1l))), $I1lll111II($I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l)))($I1lll111II($l1I11lll1l)($l1I11lll1l)))($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))), $I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($I1lll111II($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($l1I11lll1l)($l1I11lll1l))), $I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))))), array($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l), $l1IIl1II1l($l1I11lll1l), $I1IIlII1Il, $l1IIl1II1l($I1lll111II($I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))))($l1I11lll1l)), $I1lll111II($l1I11lll1l)($l1I11lll1l), $I1lll111II($l1I11lll1l)($I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))))($l1I11lll1l)), $I1IIlII1Il, $l1I11lll1l, $I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l)))($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))))($l1IIl1II1l($l1I11lll1l)))), array($l1IIl1II1l($I1lll111II($I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l)))($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l))))($I1lll111II($l1I11lll1l)($l1I11lll1l))), $I1lll111II($l1IIl1II1l($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l)))($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l))), $l1IIl1II1l($l1IIl1II1l($l1I11lll1l)), $I1lll111II($l1I11lll1l)($l1I11lll1l), $l1I11lll1l, $I1IIlII1Il, $I1lll111II($l1I11lll1l)($I1IllI1l11($I1lll111II($l1I11lll1l)($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l))), $I1lll111II($l1IIl1II1l($I1IllI1l11($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l))))($I1lll111II($l1I11lll1l)($l1I11lll1l)), $I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))($l1I11lll1l)))($I1lll111II($l1I11lll1l)($l1I11lll1l))), array($I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))), $I1lll111II($I1lll111II($l1I11lll1l)($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l)))))($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))), $I1IllI1l11($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l)), $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))), $I1IIlII1Il, $I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l), $I1lll111II($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1IIl1II1l($l1I11lll1l))))($l1I11lll1l), $l1I11lll1l, $I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))), array($I1lll111II($l1I11lll1l)($l1I11lll1l), $l1IIl1II1l($I1lll111II($l1IIl1II1l($l1I11lll1l))($I1IllI1l11($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))($l1IIl1II1l($l1I11lll1l)))), $l1IIl1II1l($l1I11lll1l), $I1IIlII1Il, $I1lll111II($I1IllI1l11($l1IIl1II1l($l1I11lll1l))($l1IIl1II1l($l1I11lll1l)))($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l))), $I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l))))), $I1lll111II($I1lll111II($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l))($l1I11lll1l))($l1I11lll1l), $I1IIlII1Il, $I1lll111II($l1IIl1II1l($l1IIl1II1l($I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))))($l1I11lll1l))))($l1I11lll1l)), array($I1IIlII1Il, $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)), $I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l))), $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))), $I1IIlII1Il, $I1lll111II($I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l))($l1IIl1II1l($I1IllI1l11($I1lll111II($l1I11lll1l)($l1I11lll1l))($I1lll111II($l1I11lll1l)($l1I11lll1l)))))($l1I11lll1l), $I1IIlII1Il, $I1lll111II($I1lll111II($I1lll111II($l1IIl1II1l($l1I11lll1l))($l1IIl1II1l($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))))($l1I11lll1l))($l1I11lll1l), $l1IIl1II1l($l1I11lll1l)), array($I1lll111II($l1I11lll1l)($l1I11lll1l), $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($I1lll111II($l1IIl1II1l($I1lll111II($l1I11lll1l)($l1IIl1II1l($l1I11lll1l))))($I1lll111II($l1I11lll1l)($l1I11lll1l)))), $l1I11lll1l, $I1lll111II($l1IIl1II1l($l1I11lll1l))($l1I11lll1l), $I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)), $I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1lll111II($I1lll111II($l1I11lll1l)($l1I11lll1l))($l1I11lll1l))), $I1IIlII1Il, $I1lll111II($I1lll111II($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($l1I11lll1l)($l1I11lll1l)))($I1lll111II($l1I11lll1l)($l1I11lll1l)), $I1IllI1l11($l1IIl1II1l($l1I11lll1l))($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($I1lll111II($l1I11lll1l)($l1I11lll1l))))));
$l11IlII11I = $l1llIlll1l[0];
for ($IlI11III11 = $I1IIlII1Il; $IlI11III11($llIIllIlll)(998244353) &lt; $IlI11III11($I1II11lIl1)(6755399441055744); $IlI11III11 = $l1IIl1II1l($IlI11III11)) &#123;
    $l1l1l11Il1 = $l1llIlll1l[$IlI11III11($IIl1II1lIl)(1)];
    $lIl11lI1I1 = $l1llIlll1l[$I1IllI1l11($IlI11III11)($IlI11III11)($IIl1II1lIl)(1)];
    $lIl11lI1I1[0] = $I1IllI1l11($l11IlII11I[0])($l1l1l11Il1[0]);
    $lIl11lI1I1[0] = $I1lll111II($I1IllI1l11($l1l1l11Il1[3])($l11IlII11I[1]))($lIl11lI1I1[0]);
    $lIl11lI1I1[8] = $I1IllI1l11($l11IlII11I[8])($l1l1l11Il1[8]);
    $lIl11lI1I1[8] = $I1lll111II($lIl11lI1I1[8])($I1IllI1l11($l11IlII11I[6])($l1l1l11Il1[2]));
    $lIl11lI1I1[7] = $I1IllI1l11($l11IlII11I[7])($l1l1l11Il1[4]);
    $lIl11lI1I1[7] = $I1lll111II($I1IllI1l11($l1l1l11Il1[1])($l11IlII11I[6]))($lIl11lI1I1[7]);
    $lIl11lI1I1[1] = $I1IllI1l11($l11IlII11I[1])($l1l1l11Il1[4]);
    $lIl11lI1I1[2] = $I1IllI1l11($l11IlII11I[1])($l1l1l11Il1[5]);
    $lIl11lI1I1[8] = $I1lll111II($I1IllI1l11($l11IlII11I[7])($l1l1l11Il1[5]))($lIl11lI1I1[8]);
    $lIl11lI1I1[4] = $I1IllI1l11($l11IlII11I[4])($l1l1l11Il1[4]);
    $lIl11lI1I1[7] = $I1lll111II($I1IllI1l11($l11IlII11I[8])($l1l1l11Il1[7]))($lIl11lI1I1[7]);
    $lIl11lI1I1[1] = $I1lll111II($I1IllI1l11($l1l1l11Il1[1])($l11IlII11I[0]))($lIl11lI1I1[1]);
    $lIl11lI1I1[1] = $I1lll111II($lIl11lI1I1[1])($I1IllI1l11($l1l1l11Il1[7])($l11IlII11I[2]));
    $lIl11lI1I1[5] = $I1IllI1l11($l11IlII11I[3])($l1l1l11Il1[2]);
    $lIl11lI1I1[5] = $I1lll111II($I1IllI1l11($l1l1l11Il1[5])($l11IlII11I[4]))($lIl11lI1I1[5]);
    $lIl11lI1I1[3] = $I1IllI1l11($l11IlII11I[4])($l1l1l11Il1[3]);
    $lIl11lI1I1[0] = $I1lll111II($I1IllI1l11($l11IlII11I[2])($l1l1l11Il1[6]))($lIl11lI1I1[0]);
    $lIl11lI1I1[5] = $I1lll111II($I1IllI1l11($l1l1l11Il1[8])($l11IlII11I[5]))($lIl11lI1I1[5]);
    $lIl11lI1I1[3] = $I1lll111II($lIl11lI1I1[3])($I1IllI1l11($l1l1l11Il1[0])($l11IlII11I[3]));
    $lIl11lI1I1[2] = $I1lll111II($I1IllI1l11($l11IlII11I[0])($l1l1l11Il1[2]))($lIl11lI1I1[2]);
    $lIl11lI1I1[2] = $I1lll111II($I1IllI1l11($l11IlII11I[2])($l1l1l11Il1[8]))($lIl11lI1I1[2]);
    $lIl11lI1I1[4] = $I1lll111II($I1IllI1l11($l11IlII11I[5])($l1l1l11Il1[7]))($lIl11lI1I1[4]);
    $lIl11lI1I1[4] = $I1lll111II($I1IllI1l11($l1l1l11Il1[1])($l11IlII11I[3]))($lIl11lI1I1[4]);
    $lIl11lI1I1[6] = $I1IllI1l11($l11IlII11I[7])($l1l1l11Il1[3]);
    $lIl11lI1I1[3] = $I1lll111II($lIl11lI1I1[3])($I1IllI1l11($l11IlII11I[5])($l1l1l11Il1[6]));
    $lIl11lI1I1[6] = $I1lll111II($I1IllI1l11($l1l1l11Il1[0])($l11IlII11I[6]))($lIl11lI1I1[6]);
    $lIl11lI1I1[6] = $I1lll111II($lIl11lI1I1[6])($I1IllI1l11($l11IlII11I[8])($l1l1l11Il1[6]));
    $l11IlII11I = $lIl11lI1I1;
&#125;
echo &#39;flag&#123;&#39;;
for ($IlI11III11 = $l1I11lll1l; $IlI11III11($llIIllIlll)(-9); $IlI11III11 = $I1lll111II($l1I11lll1l)($IlI11III11)) &#123;
    echo &quot;&#123;$l11IlII11I[$IlI11III11($I1II11lIl1)(9)]($lIl1l1lIlI)(0)&#125;-&quot;;
&#125;
echo &quot;&#123;$l11IlII11I[$IlI11III11($I1II11lIl1)(9)]($lIl1l1lIlI)(0)&#125;&#125;&quot;;</code></pre>
<h3 id="反混淆"><a href="#反混淆" class="headerlink" title="反混淆"></a>反混淆</h3><p>因为混淆用的是闭包函数，所以用正常的xdebug调式并不能看出函数间的调用，而且会因为函数调用层数过多而报错，所以这里唯一的技巧就是手动化简变量名（x</p>
<p>这里给出一份自己处理后的代码</p>
<pre><code class="php">&lt;?php 
$f1 = function ($lII1lI1IlI) &#123;
    return function ($II1IlllI11) use($lII1lI1IlI) &#123;
        return function ($ll1IlllIIl) use($II1IlllI11, $lII1lI1IlI) &#123;
            return $II1IlllI11($lII1lI1IlI($II1IlllI11)($ll1IlllIIl));
        &#125;;
    &#125;;
&#125;;
// 自增
$increase = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI + 1;
&#125;;
$f2 = function ($lIlIll1111) &#123;
    return function ($II1IIl1Ill) use($lIlIll1111) &#123;
        return function ($II1IlllI11) use($lIlIll1111, $II1IIl1Ill) &#123;
            return function ($ll1IlllIIl) use($II1IlllI11, $lIlIll1111, $II1IIl1Ill) &#123;
                return $lIlIll1111($II1IlllI11)($II1IIl1Ill($II1IlllI11)($ll1IlllIIl));
            &#125;;
        &#125;;
    &#125;;
&#125;;
// 自减
$decrease = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI - 1;
&#125;;
$ret_self = function ($II1IlllI11) &#123;
    return function ($ll1IlllIIl) &#123;
        return $ll1IlllIIl;
    &#125;;
&#125;;
// 乘3模7
$mul_mod = function ($lII1lI1IlI) &#123;
    return $lII1lI1IlI * 3 % 7;
&#125;;
$f3 = function ($lIlIll1111) use($f2, $ret_self) &#123;
    return function ($II1IIl1Ill) use($lIlIll1111, $f2, $ret_self) &#123;
        return $lIlIll1111($f2($II1IIl1Ill))($ret_self);
    &#125;;
&#125;;
$f4 = function ($II1IlllI11) &#123;
    return function ($ll1IlllIIl) use($II1IlllI11) &#123;
        return $II1IlllI11($ll1IlllIIl);
    &#125;;
&#125;;
// 模1000000007自增
$increase_mod = function ($lII1lI1IlI) &#123;
    return ($lII1lI1IlI + 1) % 1000000007;
&#125;;
// array(8)
$v1 = array(array($f2($f1($f2($f2($f4)($f2($f4)($f2($f1($f4))($f4))))($f4)))($f4), $f2($f2($f4)($f1($f1($f4))))($f2($f4)($f2($f1($f4))($f2($f4)($f4)))), $f1($f2($f2($f1($f2($f4)($f2($f2($f4)($f2($f4)($f4)))($f4))))($f4))($f4)), $f3($f1($f4))($f1($f4)), $ret_self, $f3($f1($f4))($f2($f4)($f1($f1($f4)))), $f2($f1($f4))($f2($f4)($f3($f2($f4)($f4))($f1($f2($f4)($f4))))), $f1($f1($f2($f4)($f2($f4)($f4)))), $f2($f4)($f2($f4)($f4))), array($f2($f2($f4)($f2($f4)($f4)))($f2($f4)($f2($f2($f4)($f2($f4)($f4)))($f4))), $ret_self, $f1($f1($f4)), $f2($f2($f3($f2($f1($f4))($f4))($f2($f4)($f4)))($f4))($f4), $ret_self, $f1($f2($f2($f4)($f4))($f1($f4))), $f2($f2($f2($f2($f4)($f1($f4)))($f2($f4)($f4)))($f4))($f2($f4)($f1($f4))), $f2($f2($f4)($f2($f4)($f4)))($f2($f2($f1($f4))($f2($f4)($f4)))($f2($f4)($f4))), $f3($f1($f4))($f2($f4)($f2($f4)($f1($f4))))), array($f2($f2($f4)($f4))($f4), $f1($f4), $ret_self, $f1($f2($f3($f1($f4))($f2($f4)($f2($f4)($f4))))($f4)), $f2($f4)($f4), $f2($f4)($f2($f1($f2($f4)($f2($f4)($f4))))($f4)), $ret_self, $f4, $f2($f4)($f2($f2($f2($f4)($f1($f4)))($f2($f4)($f2($f4)($f4))))($f1($f4)))), array($f1($f2($f2($f1($f2($f4)($f4)))($f1($f2($f4)($f4))))($f2($f4)($f4))), $f2($f1($f2($f2($f4)($f4))($f4)))($f1($f2($f4)($f4))), $f1($f1($f4)), $f2($f4)($f4), $f4, $ret_self, $f2($f4)($f3($f2($f4)($f4))($f2($f4)($f4))), $f2($f1($f3($f2($f2($f4)($f4))($f4))($f2($f4)($f4))))($f2($f4)($f4)), $f2($f2($f2($f4)($f2($f4)($f4)))($f2($f2($f1($f4))($f4))($f4)))($f2($f4)($f4))), array($f2($f2($f2($f4)($f4))($f4))($f2($f4)($f2($f2($f4)($f4))($f2($f4)($f4)))), $f2($f2($f4)($f1($f2($f4)($f1($f4)))))($f2($f4)($f1($f4))), $f3($f2($f1($f4))($f4))($f2($f1($f4))($f4)), $f2($f4)($f2($f4)($f2($f4)($f4))), $ret_self, $f2($f1($f4))($f4), $f2($f2($f4)($f1($f1($f4))))($f4), $f4, $f2($f4)($f2($f2($f4)($f4))($f2($f4)($f4)))), array($f2($f4)($f4), $f1($f2($f1($f4))($f3($f2($f1($f4))($f4))($f1($f4)))), $f1($f4), $ret_self, $f2($f3($f1($f4))($f1($f4)))($f2($f2($f4)($f4))($f2($f2($f4)($f4))($f4))), $f2($f2($f4)($f4))($f1($f2($f4)($f1($f2($f4)($f4))))), $f2($f2($f2($f1($f4))($f4))($f4))($f4), $ret_self, $f2($f1($f1($f2($f1($f2($f4)($f1($f4))))($f4))))($f4)), array($ret_self, $f2($f4)($f2($f4)($f4)), $f2($f1($f2($f4)($f4)))($f3($f1($f4))($f2($f4)($f4))), $f2($f4)($f2($f4)($f1($f4))), $ret_self, $f2($f2($f2($f2($f4)($f4))($f4))($f1($f3($f2($f4)($f4))($f2($f4)($f4)))))($f4), $ret_self, $f2($f2($f2($f1($f4))($f1($f2($f4)($f2($f4)($f4)))))($f4))($f4), $f1($f4)), array($f2($f4)($f4), $f2($f4)($f2($f4)($f2($f1($f2($f4)($f1($f4))))($f2($f4)($f4)))), $f4, $f2($f1($f4))($f4), $f2($f4)($f2($f4)($f4)), $f3($f1($f4))($f2($f4)($f2($f2($f4)($f4))($f4))), $ret_self, $f2($f2($f2($f4)($f2($f4)($f4)))($f2($f4)($f4)))($f2($f4)($f4)), $f3($f1($f4))($f2($f4)($f2($f4)($f2($f4)($f4))))));

// 打印初始变量
for($i = 0; $i &lt; 8; $i++) &#123;
    echo $i . &#39;: [&#39;;
    for ($f4_2 = $f4; $f4_2($increase)(-9); $f4_2 = $f2($f4)($f4_2)) &#123;
        echo &quot;&#123;$v1[$i][$f4_2($decrease)(9)]($increase_mod)(0)&#125;,&quot;;
    &#125;
    echo &quot;&#123;$v1[$i][$f4_2($decrease)(9)]($increase_mod)(0)&#125;]&quot;, &quot;\n&quot;;
&#125;

$v2 = $v1[0];

for ($f4_2 = $ret_self; $f4_2($increase)(998244353) &lt; $f4_2($decrease)(6755399441055744); $f4_2 = $f1($f4_2)) &#123;
    // $v3 = 3 ** k % 7
    $v3 = $v1[$f4_2($mul_mod)(1)];
    // $v4 其实是无用的
    // $v4 = $v1[$f3($f4_2)($f4_2)($mul_mod)(1)];
    $v4 = array(9);

    $v4[0] = $f3($v2[0])($v3[0]);
    $v4[0] = $f2($f3($v3[3])($v2[1]))($v4[0]);
    $v4[0] = $f2($f3($v2[2])($v3[6]))($v4[0]);

    $v4[1] = $f3($v2[1])($v3[4]);
    $v4[1] = $f2($f3($v3[1])($v2[0]))($v4[1]);
    $v4[1] = $f2($v4[1])($f3($v3[7])($v2[2]));

    $v4[2] = $f3($v2[1])($v3[5]);
    $v4[2] = $f2($f3($v2[0])($v3[2]))($v4[2]);
    $v4[2] = $f2($f3($v2[2])($v3[8]))($v4[2]);

    $v4[3] = $f3($v2[4])($v3[3]);
    $v4[3] = $f2($v4[3])($f3($v3[0])($v2[3]));
    $v4[3] = $f2($v4[3])($f3($v2[5])($v3[6]));

    $v4[4] = $f3($v2[4])($v3[4]);
    $v4[4] = $f2($f3($v2[5])($v3[7]))($v4[4]);
    $v4[4] = $f2($f3($v3[1])($v2[3]))($v4[4]);

    $v4[5] = $f3($v2[3])($v3[2]);
    $v4[5] = $f2($f3($v3[5])($v2[4]))($v4[5]);
    $v4[5] = $f2($f3($v3[8])($v2[5]))($v4[5]);

    $v4[6] = $f3($v2[7])($v3[3]);
    $v4[6] = $f2($f3($v3[0])($v2[6]))($v4[6]);
    $v4[6] = $f2($v4[6])($f3($v2[8])($v3[6]));

    $v4[7] = $f3($v2[7])($v3[4]);
    $v4[7] = $f2($f3($v3[1])($v2[6]))($v4[7]);
    $v4[7] = $f2($f3($v2[8])($v3[7]))($v4[7]);

    $v4[8] = $f3($v2[8])($v3[8]);
    $v4[8] = $f2($v4[8])($f3($v2[6])($v3[2]));
    $v4[8] = $f2($f3($v2[7])($v3[5]))($v4[8]);

    $v2 = $v4;
&#125;

// 倒序打印 v2
echo &#39;flag&#123;&#39;;
for ($f4_2 = $f4; $f4_2($increase)(-9); $f4_2 = $f2($f4)($f4_2)) &#123;
    echo &quot;&#123;$v2[$f4_2($decrease)(9)]($increase_mod)(0)&#125;-&quot;;
&#125;
echo &quot;&#123;$v2[$f4_2($decrease)(9)]($increase_mod)(0)&#125;&#125;&quot;;</code></pre>
<p>基本逻辑都写在注释里面了，代码的重点在如何找到for循环的规律，正所谓<strong>逆向七分解三分猜</strong>，这里其实就是对$v2，$v3的数据进行处理，而且是整整齐齐的三组数据连起来进行计算</p>
<p>我们先把矩阵打印出来看看</p>
<pre><code class="php">0: [3,5,9,8,0,4,9,9,8] =&gt; 第一步的$v2
1: [8,9,9,5,0,8,3,0,8] =&gt; 第一步的$v3
2: [9,1,0,6,2,8,0,2,3]
3: [9,9,5,0,1,2,3,7,9]
4: [5,1,5,3,0,4,9,8,8]
5: [8,0,5,7,9,0,2,9,2]
6: [2,8,0,9,0,4,7,3,0]
7: [8,7,0,8,3,3,1,8,2]</code></pre>
<p>再把经过第一次转换的flag打印出来</p>
<pre><code class="php">flag&#123;76-27-139-76-72-104-141-81-217&#125;</code></pre>
<p>然后我们就可以猜测其实它们就是进行了这样一个运算</p>
<pre><code class="php">$v4[0] = $v2[0] * $v3[0] + $v2[1] * $v3[3] + $v2[2] * $v3[6];</code></pre>
<p>根据这个规律我们可以得到初步的exp</p>
<pre><code class="python">def calc():
    global v1, v2, x

    v3 = v1[(3 ** x) % 7]
    v4 = [0] * 9

    v4[0] = (v2[0]*v3[0] + v2[1]*v3[3] + v2[2]*v3[6]) % 1000000007
    v4[1] = (v2[0]*v3[1] + v2[1]*v3[4] + v2[2]*v3[7]) % 1000000007
    v4[2] = (v2[0]*v3[2] + v2[1]*v3[5] + v2[2]*v3[8]) % 1000000007

    v4[3] = (v2[3]*v3[0] + v2[4]*v3[3] + v2[5]*v3[6]) % 1000000007
    v4[4] = (v2[3]*v3[1] + v2[4]*v3[4] + v2[5]*v3[7]) % 1000000007
    v4[5] = (v2[3]*v3[2] + v2[4]*v3[5] + v2[5]*v3[8]) % 1000000007

    v4[6] = (v2[6]*v3[0] + v2[7]*v3[3] + v2[8]*v3[6]) % 1000000007
    v4[7] = (v2[6]*v3[1] + v2[7]*v3[4] + v2[8]*v3[7]) % 1000000007
    v4[8] = (v2[6]*v3[2] + v2[7]*v3[5] + v2[8]*v3[8]) % 1000000007

    v2 = v4
    x += 1

if __name__ == &quot;__main__&quot;:

    v1 = [
        [3, 5, 9, 8, 0, 4, 9, 9, 8],
        [8, 9, 9, 5, 0, 8, 3, 0, 8], 
        [9, 1, 0, 6, 2, 8, 0, 2, 3], 
        [9, 9, 5, 0, 1, 2, 3, 7, 9], 
        [5, 1, 5, 3, 0, 4, 9, 8, 8], 
        [8, 0, 5, 7, 9, 0, 2, 9, 2], 
        [2, 8, 0, 9, 0, 4, 7, 3, 0], 
        [8, 7, 0, 8, 3, 3, 1, 8, 2]
    ]
    v2 = v1[0]
    x = 0

    count = (6755399441055744 - 998244353) // 2
    count = 2
    for _ in range(count):
        calc()

    print(&quot;flag&#123;&quot; + &quot;-&quot;.join([str(_ % 1000000007) for _ in v2]) + &quot;&#125;&quot;)</code></pre>
<h3 id="矩阵快速幂"><a href="#矩阵快速幂" class="headerlink" title="矩阵快速幂"></a>矩阵快速幂</h3><p>想要上面的脚本暴力解出来不可能的，因为需要3377699221405695次运算</p>
<p>仔细观察，其实这刚好是一个3组3*3矩阵连乘的运算，这里考察的是一个矩阵快速幂的算法</p>
<blockquote>
<p>推荐使用SageMath解题，SageMath整合了很多数学的常用算法</p>
</blockquote>
<p>参考<strong>@ver</strong>大哥exp给出自己的exp</p>
<pre><code class="python">#/usr/bin/sage
# 变换矩阵
v1 = [
    [3, 5, 9, 8, 0, 4, 9, 9, 8],
    [8, 9, 9, 5, 0, 8, 3, 0, 8], 
    [9, 1, 0, 6, 2, 8, 0, 2, 3], 
    [9, 9, 5, 0, 1, 2, 3, 7, 9], 
    [5, 1, 5, 3, 0, 4, 9, 8, 8], 
    [8, 0, 5, 7, 9, 0, 2, 9, 2], 
    [2, 8, 0, 9, 0, 4, 7, 3, 0], 
    [8, 7, 0, 8, 3, 3, 1, 8, 2]
]
# 初始矩阵
v2 = v1[0]
# 模数
p = 1000000007
# 循环次数
count = (6755399441055744 - 998244353) // 2
# 初始化3个初始矩阵
vec = [Matrix(GF(p), 1, 3, v2[3 * i: 3 * i + 3]) for i in range(3)]
# 获取6个循环矩阵
ma = [Matrix(GF(p), 3, 3, v1[(3 ** k) % 7]) for k in range(6)]
# 获取1次循环结果
mm = 1
for i in range(6):
    mm *= ma[i]
# 打印乘法余数
print(count % 6)
# 3
# 矩阵快速幂
mm = (mm ** (count//6)) * ma[0] * ma[1] * ma[2] * ma[3]
# 乘上初始矩阵
res = [(vec[i] * mm)[0] for i in range(3)]
# 打印结果
flag = [str(res[i // 3][i % 3]) for i in range(9)]
print(&quot;flag&#123;&quot; + &quot;-&quot;.join(flag) + &quot;&#125;&quot;)
# flag&#123;432734187-186275980-552238391-407500134-680581127-536698178-262495339-821428559-850467550&#125;</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Tyaoo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://tyaoo.github.io/2020/09/29/2020-0CTF-Unlimited/">https://tyaoo.github.io/2020/09/29/2020-0CTF-Unlimited/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/12/17/Vulnstack-%E7%BA%A2%E9%98%9F%E5%AE%9E%E6%88%98/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Vulnstack 红队实战</div></div></a></div><div class="next-post pull-right"><a href="/2020/08/31/2020-GACTF-web/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2020 GACTF web</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Tyaoo</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">35</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Tyaoo"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonDecoder"><span class="toc-number">1.</span> <span class="toc-text">JsonDecoder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B7%B7%E6%B7%86"><span class="toc-number">2.</span> <span class="toc-text">反混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="toc-number">3.</span> <span class="toc-text">矩阵快速幂</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Tyaoo</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>